# PDF Expense Report Feature

## ğŸ“‹ Overview

Users can now download expense reports as PDF files. The PDF includes a complete summary of all expenses between two users with professional formatting.

---

## ğŸ¯ Features

âœ… **Professional PDF Formatting**
- Clean, modern design
- Color-coded balance summary
- Detailed expense table
- Total calculations

âœ… **Complete Expense Information**
- All expenses between user and friend
- Date, description, amount, and who paid
- Balance summary (who owes whom)
- Report generation timestamp

âœ… **Easy Download**
- Single endpoint call
- Automatic filename generation
- Direct download in browser

---

## ğŸ“¡ API Endpoint

### Download Expense Report as PDF

**Endpoint**: `GET /expenses/{friend_id}/pdf`  
**Authentication**: Required (JWT Bearer token)

**Path Parameters:**
- `friend_id` (UUID): ID of the friend

**Response:**
- Content-Type: `application/pdf`
- File download with filename: `expense-report-{friend_id}-{date}.pdf`

**Example:**
```bash
curl -X GET "https://your-api.onrender.com/expenses/123e4567-e89b-12d3-a456-426614174000/pdf" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  --output expense-report.pdf
```

---

## ğŸ“„ PDF Contents

### 1. Header Section
- **Title**: "Expense Report"
- **Generated Date**: Current date and time
- **Between**: User names or emails

### 2. Balance Summary
- Shows who owes whom
- Color-coded:
  - ğŸŸ¢ Green: Friend owes you
  - ğŸ”´ Red: You owe friend
  - ğŸ”µ Blue: All settled

### 3. Expense Details Table
Columns:
- **Date**: Expense date (formatted: "Jan 15, 2025")
- **Description**: Expense description
- **Amount**: Formatted with currency symbol (â‚¹)
- **Paid By**: Name of person who paid

### 4. Total Row
- Sum of all expenses
- Highlighted row at bottom

### 5. Footer
- "Generated by Expense Tracker"

---

## ğŸ¨ PDF Design

**Layout:**
- A4 page size
- Professional margins
- Color scheme:
  - Primary: #4F46E5 (Indigo)
  - Text: #1F2937 (Dark gray)
  - Background: #F3F4F6 (Light gray)
  - Success: #059669 (Green)
  - Error: #DC2626 (Red)

**Typography:**
- Headers: Bold, larger font
- Body: Clean, readable font
- Table: Alternating row colors

---

## ğŸ’» Frontend Integration

### React/TypeScript Example

```typescript
import { authService } from './api/authService';

const downloadExpensePDF = async (friendId: string) => {
  try {
    const token = authService.getToken();
    
    const response = await fetch(
      `${API_BASE_URL}/expenses/${friendId}/pdf`,
      {
        method: 'GET',
        headers: {
          'Authorization': `Bearer ${token}`
        }
      }
    );
    
    if (!response.ok) {
      throw new Error('Failed to generate PDF');
    }
    
    // Get filename from Content-Disposition header
    const contentDisposition = response.headers.get('Content-Disposition');
    const filename = contentDisposition
      ? contentDisposition.split('filename=')[1].replace(/"/g, '')
      : `expense-report-${friendId}.pdf`;
    
    // Create blob and download
    const blob = await response.blob();
    const url = window.URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = filename;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    window.URL.revokeObjectURL(url);
    
    console.log('âœ… PDF downloaded successfully');
  } catch (error) {
    console.error('âŒ Error downloading PDF:', error);
  }
};
```

### Using Axios

```typescript
import api from './api/axios';

const downloadExpensePDF = async (friendId: string) => {
  try {
    const response = await api.get(
      `/expenses/${friendId}/pdf`,
      {
        responseType: 'blob' // Important for binary data
      }
    );
    
    // Create download link
    const blob = new Blob([response.data], { type: 'application/pdf' });
    const url = window.URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `expense-report-${friendId}.pdf`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    window.URL.revokeObjectURL(url);
  } catch (error) {
    console.error('Error downloading PDF:', error);
  }
};
```

### React Component Example

```typescript
import React, { useState } from 'react';
import { downloadExpensePDF } from '../api/expenseService';

const ExpenseList: React.FC<{ friendId: string }> = ({ friendId }) => {
  const [downloading, setDownloading] = useState(false);

  const handleDownloadPDF = async () => {
    setDownloading(true);
    try {
      await downloadExpensePDF(friendId);
      alert('PDF downloaded successfully!');
    } catch (error) {
      alert('Failed to download PDF');
    } finally {
      setDownloading(false);
    }
  };

  return (
    <div>
      <button 
        onClick={handleDownloadPDF}
        disabled={downloading}
        className="download-pdf-btn"
      >
        {downloading ? 'Generating PDF...' : 'ğŸ“„ Download PDF Report'}
      </button>
    </div>
  );
};
```

---

## ğŸ”§ Backend Implementation

### PDF Service

Location: `app/services/pdf_service.py`

**Key Features:**
- Uses ReportLab library for PDF generation
- Professional table formatting
- Color-coded balance display
- Responsive layout

**Method:**
```python
pdf_service.generate_expense_report(
    expenses: List[dict],
    current_user_name: str,
    friend_name: str,
    balance: float,
    currency_symbol: str = "â‚¹"
) -> BytesIO
```

### Endpoint Implementation

Location: `app/routers/expenses.py`

**Flow:**
1. Verify friend relationship
2. Fetch all expenses
3. Calculate balance
4. Generate PDF
5. Return as streaming response

---

## ğŸ“Š Example PDF Output

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         EXPENSE REPORT                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Generated on: January 15, 2025 at 2:30 PMâ”‚
â”‚ Between: John Doe and Jane Smith        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Balance Summary:                         â”‚
â”‚ Jane Smith owes John Doe: â‚¹500.00       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Expense Details                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Date     â”‚ Description  â”‚ Amountâ”‚ Paid Byâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Jan 10   â”‚ Lunch        â”‚ â‚¹300  â”‚ John   â”‚
â”‚ Jan 12   â”‚ Movie ticketsâ”‚ â‚¹200  â”‚ Jane   â”‚
â”‚ Jan 14   â”‚ Groceries    â”‚ â‚¹500  â”‚ John   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Total: â‚¹1,000.00                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§ª Testing

### Test with cURL

```bash
# Get your token first
TOKEN="your-jwt-token-here"
FRIEND_ID="friend-uuid-here"

# Download PDF
curl -X GET "http://127.0.0.1:8000/expenses/${FRIEND_ID}/pdf" \
  -H "Authorization: Bearer ${TOKEN}" \
  --output expense-report.pdf

# Open the PDF
open expense-report.pdf  # Mac
xdg-open expense-report.pdf  # Linux
```

### Test in Swagger UI

1. Go to: `http://127.0.0.1:8000/docs`
2. Find: `GET /expenses/{friend_id}/pdf`
3. Click "Try it out"
4. Enter friend_id
5. Click "Execute"
6. PDF will download automatically

---

## âš™ï¸ Configuration

### Currency Symbol

Default is â‚¹ (Indian Rupee). To change:

**Option 1: Modify in code**
```python
# In app/routers/expenses.py
currency_symbol="$"  # For USD
```

**Option 2: Environment Variable** (future enhancement)
```bash
CURRENCY_SYMBOL=â‚¬  # For Euro
```

---

## ğŸš¨ Error Handling

### Common Errors

**404 - Friend not found:**
```json
{
  "detail": "Friend not found"
}
```

**401 - Unauthorized:**
```json
{
  "detail": "Could not validate credentials"
}
```

**500 - PDF Generation Error:**
- Check server logs
- Verify reportlab is installed
- Check expense data format

---

## ğŸ“¦ Dependencies

**Added to requirements.txt:**
```
reportlab==4.0.7
```

**Installation:**
```bash
pip install reportlab==4.0.7
```

---

## ğŸ¯ Use Cases

1. **Monthly Expense Summary**
   - Download at end of month
   - Share with friend for settlement

2. **Expense Reconciliation**
   - Review all expenses
   - Verify calculations
   - Keep records

3. **Financial Planning**
   - Track spending patterns
   - Analyze expense categories
   - Budget planning

4. **Legal/Tax Records**
   - Official documentation
   - Tax deduction records
   - Business expense tracking

---

## ğŸ”„ Future Enhancements

Possible improvements:
- [ ] Filter by date range
- [ ] Group by category
- [ ] Charts and graphs
- [ ] Multiple currency support
- [ ] Email PDF directly
- [ ] Custom templates
- [ ] Multi-page support for large reports

---

## ğŸ“ Summary

âœ… **New Endpoint**: `GET /expenses/{friend_id}/pdf`  
âœ… **Returns**: PDF file download  
âœ… **Includes**: All expenses, balance, totals  
âœ… **Format**: Professional, printable  
âœ… **Authentication**: Required  

**Ready to use!** Just call the endpoint and the PDF will download automatically! ğŸ“„âœ¨

